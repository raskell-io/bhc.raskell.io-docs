<!DOCTYPE html>
<html lang="{{ lang | default(value='en') }}" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="color-scheme" content="dark light">

    <title>{% block title %}{{ config.title }}{% endblock %}</title>
    <meta name="description" content="{% block description %}{{ config.description }}{% endblock %}">

    {% if config.extra.keywords %}
    <meta name="keywords" content="{{ config.extra.keywords }}">
    {% endif %}
    <meta name="author" content="{{ config.extra.author | default(value='raskell.io') }}">

    <!-- Canonical URL -->
    <link rel="canonical" href="{{ current_url | default(value=config.base_url) }}">

    <!-- Open Graph -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="{% block og_title %}{{ config.title }}{% endblock %}">
    <meta property="og:description" content="{{ config.description }}">
    <meta property="og:url" content="{{ current_url | default(value=config.base_url) }}">
    <meta property="og:site_name" content="{{ config.title }}">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="{% block twitter_title %}{{ config.title }}{% endblock %}">
    <meta name="twitter:description" content="{{ config.description }}">

    <!-- Fonts: Clash Display for brand, Inter for body, JetBrains Mono for code -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Clash Display from Fontshare -->
    <link href="https://api.fontshare.com/v2/css?f[]=clash-display@400,500,600,700&display=swap" rel="stylesheet">

    <!-- Styles -->
    <link rel="stylesheet" href="{{ get_url(path='style.css', cachebust=true) | safe }}">

    <!-- Search index for docs -->
    {% if config.build_search_index %}
    <script src="{{ get_url(path='elasticlunr.min.js', cachebust=true) | safe }}" defer></script>
    <script src="{{ get_url(path='search_index.en.js', cachebust=true) | safe }}" defer></script>
    <script src="{{ get_url(path='js/search.js', cachebust=true) | safe }}" defer></script>
    {% endif %}

    <!-- Theme toggle script (before content to prevent flash) -->
    <script>
        (function() {
            const theme = localStorage.getItem('theme') || 'dark';
            document.documentElement.setAttribute('data-theme', theme);
        })();
    </script>
</head>
<body class="{% block body_class %}{% endblock %}">
    {% block sidebar %}{% endblock %}

    <div class="layout">
        {% include "partials/header.html" %}

    {% if config.build_search_index %}
    {% include "partials/search.html" %}
    {% endif %}

        <main class="main" role="main">
            <div class="main__container">
                {% block content %}{% endblock %}
            </div>
        </main>

        {% include "partials/footer.html" %}
    </div>

    <!-- Theme toggle functionality -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const toggle = document.querySelector('.theme-toggle');
            if (toggle) {
                toggle.addEventListener('click', function() {
                    const current = document.documentElement.getAttribute('data-theme');
                    const next = current === 'dark' ? 'light' : 'dark';
                    document.documentElement.setAttribute('data-theme', next);
                    localStorage.setItem('theme', next);
                });
            }
        });
    </script>

    <!-- Sidebar toggle for mobile -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const sidebarToggle = document.querySelector('.sidebar-toggle');
            const sidebar = document.querySelector('.sidebar');
            const sidebarClose = document.querySelector('.sidebar__close');

            if (sidebarToggle && sidebar) {
                sidebarToggle.addEventListener('click', function() {
                    sidebar.classList.toggle('sidebar--open');
                    document.body.classList.toggle('sidebar-open');
                });
            }

            if (sidebarClose && sidebar) {
                sidebarClose.addEventListener('click', function() {
                    sidebar.classList.remove('sidebar--open');
                    document.body.classList.remove('sidebar-open');
                });
            }
        });
    </script>
</body>
</html>
