<aside id="sidebar" class="sidebar" role="complementary" aria-labelledby="sidebar-title">
    <div class="sidebar__header">
        <span id="sidebar-title" class="sidebar__title">[ NAVIGATION ]</span>
        <button class="sidebar__close" type="button" aria-label="Close sidebar">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M18 6 6 18"/>
                <path d="m6 6 12 12"/>
            </svg>
        </button>
    </div>

    <nav class="sidebar__content" aria-label="Documentation navigation">
        <div class="toc">
            {# Get the docs section directly #}
            {% set docs_section = get_section(path="docs/_index.md", required=false) %}

            {% if docs_section %}
            {# Top-level pages (Installation, Quick Start) #}
            {% if docs_section.pages %}
            <div class="toc__section">
                <div class="toc__section-title">[ GETTING STARTED ]</div>
                <ul class="toc__list">
                    {% for pg in docs_section.pages %}
                    {% if pg.extra.hide_from_toc is not defined or not pg.extra.hide_from_toc %}
                    <li class="toc__item">
                        <a href="{{ pg.permalink | safe }}" class="toc__link {% if current_path is defined and current_path == pg.path %}toc__link--active{% endif %}">
                            {{ pg.title }}
                        </a>
                    </li>
                    {% endif %}
                    {% endfor %}
                </ul>
            </div>
            {% endif %}

            {# Subsections (Profiles, Targets, etc.) #}
            {% if docs_section.subsections %}
            {% for subsection_path in docs_section.subsections %}
            {% set subsection = get_section(path=subsection_path) %}
            <div class="toc__section">
                <div class="toc__section-title">[ {{ subsection.title | upper }} ]</div>
                <ul class="toc__list">
                    {% for pg in subsection.pages %}
                    <li class="toc__item">
                        <a href="{{ pg.permalink | safe }}" class="toc__link {% if current_path is defined and current_path == pg.path %}toc__link--active{% endif %}">
                            {{ pg.title }}
                        </a>
                    </li>
                    {% endfor %}
                </ul>
            </div>
            {% endfor %}
            {% endif %}
            {% endif %}

            {# On this page - headings from current page #}
            {% if page and page.toc %}
            <div class="toc__section toc__section--page">
                <div class="toc__section-title">[ ON THIS PAGE ]</div>
                <ul class="toc__list">
                    {% for item in page.toc %}
                    <li class="toc__item">
                        <a href="#{{ item.id }}" class="toc__link toc__link--heading">
                            {{ item.title }}
                        </a>
                        {% if item.children %}
                        <ul class="toc__list toc__list--nested">
                            {% for child in item.children %}
                            <li class="toc__item">
                                <a href="#{{ child.id }}" class="toc__link toc__link--heading">
                                    {{ child.title }}
                                </a>
                            </li>
                            {% endfor %}
                        </ul>
                        {% endif %}
                    </li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}
        </div>
    </nav>

    <div class="sidebar__footer">
        <a href="{{ config.extra.product_url | default(value='https://bhc.raskell.io') }}" class="sidebar__back">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M19 12H5"/>
                <path d="m12 19-7-7 7-7"/>
            </svg>
            <span>Back to BHC</span>
        </a>
    </div>
</aside>
